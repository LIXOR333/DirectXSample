name: Build Rust Alkad 2588 Cheat DLL

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Cache dependencies
      uses: actions/cache@v4
      with:
        path: |
          imgui-master
          minhook-master
          zlib-1.3.1
          json-develop
        key: ${{ runner.os }}-deps-${{ hashFiles('build.yml') }}

    - name: Set up MSVC
      uses: ilammy/msvc-dev-cmd@v1

    - name: Create log directory
      run: mkdir logs
      shell: cmd

    - name: Download ImGui
      run: |
        echo Downloading ImGui... >> logs/build.log
        curl -L -o imgui.zip https://github.com/ocornut/imgui/archive/refs/heads/master.zip && echo ImGui downloaded from primary (GitHub) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
          echo Primary ImGui download or validation failed, trying mirror 1... >> logs/build.log
          curl -L -o imgui.zip https://mirror.ghproxy.com/https://github.com/ocornut/imgui/archive/refs/heads/master.zip && echo ImGui downloaded from mirror 1 (ghproxy) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
            echo Mirror 1 failed, trying mirror 2... >> logs/build.log
            curl -L -o imgui.zip https://codeload.github.com/ocornut/imgui/zip/refs/heads/master && echo ImGui downloaded from mirror 2 (codeload) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
              echo Mirror 2 failed, trying mirror 3... >> logs/build.log
              curl -L -o imgui.zip https://web.archive.org/web/20250518000000/https://github.com/ocornut/imgui/archive/refs/heads/master.zip && echo ImGui downloaded from mirror 3 (archive.org) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                echo Mirror 3 failed, trying mirror 4... >> logs/build.log
                curl -L -o imgui.zip https://github.com/mirror-imgui/imgui/archive/refs/heads/master.zip && echo ImGui downloaded from mirror 4 (mirror-imgui) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                  echo Mirror 4 failed, trying mirror 5... >> logs/build.log
                  curl -L -o imgui.zip https://sourceforge.net/projects/imgui/files/master/imgui-master.zip && echo ImGui downloaded from mirror 5 (SourceForge) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                    echo Mirror 5 failed, trying mirror 6... >> logs/build.log
                    curl -L -o imgui.zip https://bitbucket.org/imgui-mirror/imgui/get/master.zip && echo ImGui downloaded from mirror 6 (Bitbucket) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                      echo Mirror 6 failed, trying mirror 7... >> logs/build.log
                      curl -L -o imgui.zip https://gitlab.com/imgui-mirror/imgui/-/archive/master/imgui-master.zip && echo ImGui downloaded from mirror 7 (GitLab) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                        echo Mirror 7 failed, trying mirror 8... >> logs/build.log
                        curl -L -o imgui.zip https://gitcode.net/mirrors/ocornut/imgui/-/archive/master/imgui-master.zip && echo ImGui downloaded from mirror 8 (GitCode) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                          echo Mirror 8 failed, trying mirror 9... >> logs/build.log
                          curl -L -o imgui.zip https://gitee.com/mirror-imgui/imgui/repository/archive/master.zip && echo ImGui downloaded from mirror 9 (Gitee) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                            echo Mirror 9 failed, trying mirror 10... >> logs/build.log
                            curl -L -o imgui.zip https://codeberg.org/imgui-mirror/imgui/archive/master.zip && echo ImGui downloaded from mirror 10 (Codeberg) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                              echo Mirror 10 failed, trying mirror 11... >> logs/build.log
                              curl -L -o imgui.zip https://git.savannah.gnu.org/cgit/imgui.git/snapshot/imgui-master.tar.gz && echo ImGui downloaded from mirror 11 (Savannah) >> logs/build.log && tar -tzf imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                                echo Mirror 11 failed, trying mirror 12... >> logs/build.log
                                curl -L -o imgui.zip https://archive.org/download/github.com-ocornut-imgui/imgui-master.zip && echo ImGui downloaded from mirror 12 (Internet Archive) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                                  echo Mirror 12 failed, trying mirror 13... >> logs/build.log
                                  curl -L -o imgui.zip https://files.phpmyadmin.net/imgui/master/imgui-master.zip && echo ImGui downloaded from mirror 13 (phpMyAdmin) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                                    echo Mirror 13 failed, trying mirror 14... >> logs/build.log
                                    curl -L -o imgui.zip https://mirror.centos.org/imgui/master/imgui-master.zip && echo ImGui downloaded from mirror 14 (CentOS Mirror) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                                      echo Mirror 14 failed, trying mirror 15... >> logs/build.log
                                      curl -L -o imgui.zip https://mirror.fsf.org/imgui/master/imgui-master.zip && echo ImGui downloaded from mirror 15 (FSF Mirror) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                                        echo Mirror 15 failed, trying mirror 16... >> logs/build.log
                                        curl -L -o imgui.zip https://mirror.rackspace.com/imgui/master/imgui-master.zip && echo ImGui downloaded from mirror 16 (Rackspace) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                                          echo Mirror 16 failed, trying mirror 17... >> logs/build.log
                                          curl -L -o imgui.zip https://mirror.netcologne.de/imgui/master/imgui-master.zip && echo ImGui downloaded from mirror 17 (NetCologne) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                                            echo Mirror 17 failed, trying mirror 18... >> logs/build.log
                                            curl -L -o imgui.zip https://mirror.leaseweb.com/imgui/master/imgui-master.zip && echo ImGui downloaded from mirror 18 (Leaseweb) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                                              echo Mirror 18 failed, trying mirror 19... >> logs/build.log
                                              curl -L -o imgui.zip https://mirror.nexcess.net/imgui/master/imgui-master.zip && echo ImGui downloaded from mirror 19 (Nexcess) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                                                echo Mirror 19 failed, trying mirror 20... >> logs/build.log
                                                curl -L -o imgui.zip https://mirror.umd.edu/imgui/master/imgui-master.zip && echo ImGui downloaded from mirror 20 (UMD) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                                                  echo Mirror 20 failed, trying mirror 21... >> logs/build.log
                                                  curl -L -o imgui.zip https://mirror.csclub.uwaterloo.ca/imgui/master/imgui-master.zip && echo ImGui downloaded from mirror 21 (UWaterloo) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                                                    echo Mirror 21 failed, trying mirror 22... >> logs/build.log
                                                    curl -L -o imgui.zip https://mirror.ox.ac.uk/imgui/master/imgui-master.zip && echo ImGui downloaded from mirror 22 (Oxford) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                                                      echo Mirror 22 failed, trying mirror 23... >> logs/build.log
                                                      curl -L -o imgui.zip https://mirror.yandex.ru/imgui/master/imgui-master.zip && echo ImGui downloaded from mirror 23 (Yandex) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                                                        echo Mirror 23 failed, trying mirror 24... >> logs/build.log
                                                        curl -L -o imgui.zip https://mirror.1und1.de/imgui/master/imgui-master.zip && echo ImGui downloaded from mirror 24 (1und1) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                                                          echo Mirror 24 failed, trying mirror 25... >> logs/build.log
                                                          curl -L -o imgui.zip https://mirror.easyname.at/imgui/master/imgui-master.zip && echo ImGui downloaded from mirror 25 (Easyname) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                                                            echo Mirror 25 failed, trying mirror 26... >> logs/build.log
                                                            curl -L -o imgui.zip https://mirror.hetzner.de/imgui/master/imgui-master.zip && echo ImGui downloaded from mirror 26 (Hetzner) >> logs/build.log && unzip -t imgui.zip >> logs/build.log 2>&1 && echo ImGui archive validated >> logs/build.log || (
                                                              echo ImGui download or validation failed from all sources >> logs/build.log
                                                              exit 1
                                                            )
                                                          )
                                                        )
                                                      )
                                                    )
                                                  )
                                                )
                                              )
                                            )
                                          )
                                        )
                                      )
                                    )
                                  )
                                )
                              )
                            )
                          )
                        )
                      )
                    )
                  )
                )
              )
            )
          )
        )
        unzip -o imgui.zip
        echo Checking directory structure after unzip... >> logs/build.log
        dir | findstr imgui- >> logs/build.log 2>&1
        for /f "delims=" %%i in ('dir /b /ad | findstr imgui-') do (
          echo Found directory: %%i >> logs/build.log
          ren "%%i" imgui-master >> logs/build.log 2>&1
          if errorlevel 1 (
            echo Failed to rename %%i to imgui-master >> logs/build.log
            exit 1
          )
        )
        if not exist imgui-master (
          echo Error: imgui-master directory not found after rename >> logs/build.log
          exit 1
        )
        if not exist imgui-master\imgui.h (
          echo Warning: imgui.h not found in imgui-master, checking subdirectories... >> logs/build.log
          dir imgui-master /s /b | findstr imgui.h >> logs/build.log 2>&1
          if errorlevel 1 (
            echo Error: imgui.h not found in imgui-master or its subdirectories >> logs/build.log
            exit 1
          )
        ) else (
          echo imgui.h found in imgui-master >> logs/build.log
        )
        echo ImGui unzipped and structure verified >> logs/build.log
      shell: cmd
      if: steps.cache.outputs.cache-hit != 'true'

    - name: Download MinHook
      run: |
        echo Downloading MinHook... >> logs/build.log
        curl -L -o minhook.zip https://github.com/TsudaKageyu/minhook/archive/refs/heads/master.zip && echo MinHook downloaded from primary (GitHub) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
          echo Primary MinHook download or validation failed, trying mirror 1... >> logs/build.log
          curl -L -o minhook.zip https://mirror.ghproxy.com/https://github.com/TsudaKageyu/minhook/archive/refs/heads/master.zip && echo MinHook downloaded from mirror 1 (ghproxy) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
            echo Mirror 1 failed, trying mirror 2... >> logs/build.log
            curl -L -o minhook.zip https://codeload.github.com/TsudaKageyu/minhook/zip/refs/heads/master && echo MinHook downloaded from mirror 2 (codeload) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
              echo Mirror 2 failed, trying mirror 3... >> logs/build.log
              curl -L -o minhook.zip https://web.archive.org/web/20250518000000/https://github.com/TsudaKageyu/minhook/archive/refs/heads/master.zip && echo MinHook downloaded from mirror 3 (archive.org) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                echo Mirror 3 failed, trying mirror 4... >> logs/build.log
                curl -L -o minhook.zip https://github.com/mirror-minhook/minhook/archive/refs/heads/master.zip && echo MinHook downloaded from mirror 4 (mirror-minhook) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                  echo Mirror 4 failed, trying mirror 5... >> logs/build.log
                  curl -L -o minhook.zip https://sourceforge.net/projects/minhook/files/master/minhook-master.zip && echo MinHook downloaded from mirror 5 (SourceForge) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                    echo Mirror 5 failed, trying mirror 6... >> logs/build.log
                    curl -L -o minhook.zip https://bitbucket.org/minhook-mirror/minhook/get/master.zip && echo MinHook downloaded from mirror 6 (Bitbucket) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                      echo Mirror 6 failed, trying mirror 7... >> logs/build.log
                      curl -L -o minhook.zip https://gitlab.com/minhook-mirror/minhook/-/archive/master/minhook-master.zip && echo MinHook downloaded from mirror 7 (GitLab) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                        echo Mirror 7 failed, trying mirror 8... >> logs/build.log
                        curl -L -o minhook.zip https://gitcode.net/mirrors/TsudaKageyu/minhook/-/archive/master/minhook-master.zip && echo MinHook downloaded from mirror 8 (GitCode) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                          echo Mirror 8 failed, trying mirror 9... >> logs/build.log
                          curl -L -o minhook.zip https://gitee.com/mirror-minhook/minhook/repository/archive/master.zip && echo MinHook downloaded from mirror 9 (Gitee) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                            echo Mirror 9 failed, trying mirror 10... >> logs/build.log
                            curl -L -o minhook.zip https://codeberg.org/minhook-mirror/minhook/archive/master.zip && echo MinHook downloaded from mirror 10 (Codeberg) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                              echo Mirror 10 failed, trying mirror 11... >> logs/build.log
                              curl -L -o minhook.zip https://git.savannah.gnu.org/cgit/minhook.git/snapshot/minhook-master.tar.gz && echo MinHook downloaded from mirror 11 (Savannah) >> logs/build.log && tar -tzf minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                                echo Mirror 11 failed, trying mirror 12... >> logs/build.log
                                curl -L -o minhook.zip https://archive.org/download/github.com-TsudaKageyu-minhook/minhook-master.zip && echo MinHook downloaded from mirror 12 (Internet Archive) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                                  echo Mirror 12 failed, trying mirror 13... >> logs/build.log
                                  curl -L -o minhook.zip https://files.phpmyadmin.net/minhook/master/minhook-master.zip && echo MinHook downloaded from mirror 13 (phpMyAdmin) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                                    echo Mirror 13 failed, trying mirror 14... >> logs/build.log
                                    curl -L -o minhook.zip https://mirror.centos.org/minhook/master/minhook-master.zip && echo MinHook downloaded from mirror 14 (CentOS Mirror) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                                      echo Mirror 14 failed, trying mirror 15... >> logs/build.log
                                      curl -L -o minhook.zip https://mirror.fsf.org/minhook/master/minhook-master.zip && echo MinHook downloaded from mirror 15 (FSF Mirror) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                                        echo Mirror 15 failed, trying mirror 16... >> logs/build.log
                                        curl -L -o minhook.zip https://mirror.rackspace.com/minhook/master/minhook-master.zip && echo MinHook downloaded from mirror 16 (Rackspace) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                                          echo Mirror 16 failed, trying mirror 17... >> logs/build.log
                                          curl -L -o minhook.zip https://mirror.netcologne.de/minhook/master/minhook-master.zip && echo MinHook downloaded from mirror 17 (NetCologne) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                                            echo Mirror 17 failed, trying mirror 18... >> logs/build.log
                                            curl -L -o minhook.zip https://mirror.leaseweb.com/minhook/master/minhook-master.zip && echo MinHook downloaded from mirror 18 (Leaseweb) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                                              echo Mirror 18 failed, trying mirror 19... >> logs/build.log
                                              curl -L -o minhook.zip https://mirror.nexcess.net/minhook/master/minhook-master.zip && echo MinHook downloaded from mirror 19 (Nexcess) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                                                echo Mirror 19 failed, trying mirror 20... >> logs/build.log
                                                curl -L -o minhook.zip https://mirror.umd.edu/minhook/master/minhook-master.zip && echo MinHook downloaded from mirror 20 (UMD) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                                                  echo Mirror 20 failed, trying mirror 21... >> logs/build.log
                                                  curl -L -o minhook.zip https://mirror.csclub.uwaterloo.ca/minhook/master/minhook-master.zip && echo MinHook downloaded from mirror 21 (UWaterloo) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                                                    echo Mirror 21 failed, trying mirror 22... >> logs/build.log
                                                    curl -L -o minhook.zip https://mirror.ox.ac.uk/minhook/master/minhook-master.zip && echo MinHook downloaded from mirror 22 (Oxford) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                                                      echo Mirror 22 failed, trying mirror 23... >> logs/build.log
                                                      curl -L -o minhook.zip https://mirror.yandex.ru/minhook/master/minhook-master.zip && echo MinHook downloaded from mirror 23 (Yandex) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                                                        echo Mirror 23 failed, trying mirror 24... >> logs/build.log
                                                        curl -L -o minhook.zip https://mirror.1und1.de/minhook/master/minhook-master.zip && echo MinHook downloaded from mirror 24 (1und1) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                                                          echo Mirror 24 failed, trying mirror 25... >> logs/build.log
                                                          curl -L -o minhook.zip https://mirror.easyname.at/minhook/master/minhook-master.zip && echo MinHook downloaded from mirror 25 (Easyname) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                                                            echo Mirror 25 failed, trying mirror 26... >> logs/build.log
                                                            curl -L -o minhook.zip https://mirror.hetzner.de/minhook/master/minhook-master.zip && echo MinHook downloaded from mirror 26 (Hetzner) >> logs/build.log && unzip -t minhook.zip >> logs/build.log 2>&1 && echo MinHook archive validated >> logs/build.log || (
                                                              echo MinHook download or validation failed from all sources >> logs/build.log
                                                              exit 1
                                                            )
                                                          )
                                                        )
                                                      )
                                                    )
                                                  )
                                                )
                                              )
                                            )
                                          )
                                        )
                                      )
                                    )
                                  )
                                )
                              )
                            )
                          )
                        )
                      )
                    )
                  )
                )
              )
            )
          )
        )
        unzip -o minhook.zip
        echo MinHook unzipped >> logs/build.log
      shell: cmd
      if: steps.cache.outputs.cache-hit != 'true'

    - name: Download zlib
      run: |
        echo Downloading zlib... >> logs/build.log
        curl -L -o zlib.tar.gz https://zlib.net/zlib-1.3.1.tar.gz && echo zlib downloaded from primary (zlib.net) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
          echo Primary zlib download or validation failed, trying mirror 1... >> logs/build.log
          curl -L -o zlib.tar.gz https://github.com/madler/zlib/releases/download/v1.3.1/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 1 (GitHub) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
            echo Mirror 1 failed, trying mirror 2... >> logs/build.log
            curl -L -o zlib.tar.gz https://sourceforge.net/projects/libpng/files/zlib/1.3.1/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 2 (SourceForge) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
              echo Mirror 2 failed, trying mirror 3... >> logs/build.log
              curl -L -o zlib.tar.gz https://web.archive.org/web/20250518000000/https://zlib.net/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 3 (archive.org) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                echo Mirror 3 failed, trying mirror 4... >> logs/build.log
                curl -L -o zlib.tar.gz https://zlib.net/fossils/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 4 (zlib fossils) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                  echo Mirror 4 failed, trying mirror 5... >> logs/build.log
                  curl -L -o zlib.tar.gz https://mirror.ghproxy.com/https://zlib.net/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 5 (ghproxy) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                    echo Mirror 5 failed, trying mirror 6... >> logs/build.log
                    curl -L -o zlib.tar.gz https://bitbucket.org/zlib-mirror/zlib/get/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 6 (Bitbucket) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                      echo Mirror 6 failed, trying mirror 7... >> logs/build.log
                      curl -L -o zlib.tar.gz https://gitlab.com/zlib-mirror/zlib/-/archive/1.3.1/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 7 (GitLab) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                        echo Mirror 7 failed, trying mirror 8... >> logs/build.log
                        curl -L -o zlib.tar.gz https://gitcode.net/mirrors/madler/zlib/-/archive/v1.3.1/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 8 (GitCode) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                          echo Mirror 8 failed, trying mirror 9... >> logs/build.log
                          curl -L -o zlib.tar.gz https://gitee.com/mirror-zlib/zlib/repository/archive/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 9 (Gitee) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                            echo Mirror 9 failed, trying mirror 10... >> logs/build.log
                            curl -L -o zlib.tar.gz https://codeberg.org/zlib-mirror/zlib/archive/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 1
0 (Codeberg) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                              echo Mirror 10 failed, trying mirror 11... >> logs/build.log
                              curl -L -o zlib.tar.gz https://git.savannah.gnu.org/cgit/zlib.git/snapshot/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 11 (Savannah) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                                echo Mirror 11 failed, trying mirror 12... >> logs/build.log
                                curl -L -o zlib.tar.gz https://archive.org/download/zlib-1.3.1/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 12 (Internet Archive) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                                  echo Mirror 12 failed, trying mirror 13... >> logs/build.log
                                  curl -L -o zlib.tar.gz https://files.phpmyadmin.net/zlib/1.3.1/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 13 (phpMyAdmin) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                                    echo Mirror 13 failed, trying mirror 14... >> logs/build.log
                                    curl -L -o zlib.tar.gz https://mirror.centos.org/zlib/1.3.1/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 14 (CentOS Mirror) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                                      echo Mirror 14 failed, trying mirror 15... >> logs/build.log
                                      curl -L -o zlib.tar.gz https://mirror.fsf.org/zlib/1.3.1/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 15 (FSF Mirror) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                                        echo Mirror 15 failed, trying mirror 16... >> logs/build.log
                                        curl -L -o zlib.tar.gz https://mirror.rackspace.com/zlib/1.3.1/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 16 (Rackspace) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                                          echo Mirror 16 failed, trying mirror 17... >> logs/build.log
                                          curl -L -o zlib.tar.gz https://mirror.netcologne.de/zlib/1.3.1/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 17 (NetCologne) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                                            echo Mirror 17 failed, trying mirror 18... >> logs/build.log
                                            curl -L -o zlib.tar.gz https://mirror.leaseweb.com/zlib/1.3.1/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 18 (Leaseweb) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                                              echo Mirror 18 failed, trying mirror 19... >> logs/build.log
                                              curl -L -o zlib.tar.gz https://mirror.nexcess.net/zlib/1.3.1/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 19 (Nexcess) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                                                echo Mirror 19 failed, trying mirror 20... >> logs/build.log
                                                curl -L -o zlib.tar.gz https://mirror.umd.edu/zlib/1.3.1/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 20 (UMD) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                                                  echo Mirror 20 failed, trying mirror 21... >> logs/build.log
                                                  curl -L -o zlib.tar.gz https://mirror.csclub.uwaterloo.ca/zlib/1.3.1/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 21 (UWaterloo) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                                                    echo Mirror 21 failed, trying mirror 22... >> logs/build.log
                                                    curl -L -o zlib.tar.gz https://mirror.ox.ac.uk/zlib/1.3.1/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 22 (Oxford) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                                                      echo Mirror 22 failed, trying mirror 23... >> logs/build.log
                                                      curl -L -o zlib.tar.gz https://mirror.yandex.ru/zlib/1.3.1/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 23 (Yandex) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                                                        echo Mirror 23 failed, trying mirror 24... >> logs/build.log
                                                        curl -L -o zlib.tar.gz https://mirror.1und1.de/zlib/1.3.1/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 24 (1und1) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                                                          echo Mirror 24 failed, trying mirror 25... >> logs/build.log
                                                          curl -L -o zlib.tar.gz https://mirror.easyname.at/zlib/1.3.1/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 25 (Easyname) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                                                            echo Mirror 25 failed, trying mirror 26... >> logs/build.log
                                                            curl -L -o zlib.tar.gz https://mirror.hetzner.de/zlib/1.3.1/zlib-1.3.1.tar.gz && echo zlib downloaded from mirror 26 (Hetzner) >> logs/build.log && tar -tzf zlib.tar.gz >> logs/build.log 2>&1 && echo zlib archive validated >> logs/build.log || (
                                                              echo zlib download or validation failed from all sources >> logs/build.log
                                                              exit 1
                                                            )
                                                          )
                                                        )
                                                      )
                                                    )
                                                  )
                                                )
                                              )
                                            )
                                          )
                                        )
                                      )
                                    )
                                  )
                                )
                              )
                            )
                          )
                        )
                      )
                    )
                  )
                )
              )
            )
          )
        )
        tar -xzf zlib.tar.gz
        ren zlib-1.3.1 zlib
        echo zlib unzipped and renamed >> logs/build.log
      shell: cmd
      if: steps.cache.outputs.cache-hit != 'true'

    - name: Download nlohmann/json
      run: |
        echo Downloading nlohmann/json... >> logs/build.log
        curl -L -o json.zip https://github.com/nlohmann/json/archive/refs/heads/develop.zip && echo nlohmann/json downloaded from primary (GitHub) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
          echo Primary nlohmann/json download or validation failed, trying mirror 1... >> logs/build.log
          curl -L -o json.zip https://mirror.ghproxy.com/https://github.com/nlohmann/json/archive/refs/heads/develop.zip && echo nlohmann/json downloaded from mirror 1 (ghproxy) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
            echo Mirror 1 failed, trying mirror 2... >> logs/build.log
            curl -L -o json.zip https://codeload.github.com/nlohmann/json/zip/refs/heads/develop && echo nlohmann/json downloaded from mirror 2 (codeload) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
              echo Mirror 2 failed, trying mirror 3... >> logs/build.log
              curl -L -o json.zip https://web.archive.org/web/20250518000000/https://github.com/nlohmann/json/archive/refs/heads/develop.zip && echo nlohmann/json downloaded from mirror 3 (archive.org) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                echo Mirror 3 failed, trying mirror 4... >> logs/build.log
                curl -L -o json.zip https://github.com/mirror-nlohmann-json/json/archive/refs/heads/develop.zip && echo nlohmann/json downloaded from mirror 4 (mirror-nlohmann-json) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                  echo Mirror 4 failed, trying mirror 5... >> logs/build.log
                  curl -L -o json.zip https://sourceforge.net/projects/nlohmann-json/files/develop/json-develop.zip && echo nlohmann/json downloaded from mirror 5 (SourceForge) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                    echo Mirror 5 failed, trying mirror 6... >> logs/build.log
                    curl -L -o json.zip https://bitbucket.org/nlohmann-json-mirror/json/get/develop.zip && echo nlohmann/json downloaded from mirror 6 (Bitbucket) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                      echo Mirror 6 failed, trying mirror 7... >> logs/build.log
                      curl -L -o json.zip https://gitlab.com/nlohmann-json-mirror/json/-/archive/develop/json-develop.zip && echo nlohmann/json downloaded from mirror 7 (GitLab) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                        echo Mirror 7 failed, trying mirror 8... >> logs/build.log
                        curl -L -o json.zip https://gitcode.net/mirrors/nlohmann/json/-/archive/develop/json-develop.zip && echo nlohmann/json downloaded from mirror 8 (GitCode) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                          echo Mirror 8 failed, trying mirror 9... >> logs/build.log
                          curl -L -o json.zip https://gitee.com/mirror-nlohmann-json/json/repository/archive/develop.zip && echo nlohmann/json downloaded from mirror 9 (Gitee) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                            echo Mirror 9 failed, trying mirror 10... >> logs/build.log
                            curl -L -o json.zip https://codeberg.org/nlohmann-json-mirror/json/archive/develop.zip && echo nlohmann/json downloaded from mirror 10 (Codeberg) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                              echo Mirror 10 failed, trying mirror 11... >> logs/build.log
                              curl -L -o json.zip https://git.savannah.gnu.org/cgit/json.git/snapshot/json-develop.tar.gz && echo nlohmann/json downloaded from mirror 11 (Savannah) >> logs/build.log && tar -tzf json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                                echo Mirror 11 failed, trying mirror 12... >> logs/build.log
                                curl -L -o json.zip https://archive.org/download/github.com-nlohmann-json/json-develop.zip && echo nlohmann/json downloaded from mirror 12 (Internet Archive) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                                  echo Mirror 12 failed, trying mirror 13... >> logs/build.log
                                  curl -L -o json.zip https://files.phpmyadmin.net/nlohmann/json/develop/json-develop.zip && echo nlohmann/json downloaded from mirror 13 (phpMyAdmin) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                                    echo Mirror 13 failed, trying mirror 14... >> logs/build.log
                                    curl -L -o json.zip https://mirror.centos.org/nlohmann/json/develop/json-develop.zip && echo nlohmann/json downloaded from mirror 14 (CentOS Mirror) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                                      echo Mirror 14 failed, trying mirror 15... >> logs/build.log
                                      curl -L -o json.zip https://mirror.fsf.org/nlohmann/json/develop/json-develop.zip && echo nlohmann/json downloaded from mirror 15 (FSF Mirror) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                                        echo Mirror 15 failed, trying mirror 16... >> logs/build.log
                                        curl -L -o json.zip https://mirror.rackspace.com/nlohmann/json/develop/json-develop.zip && echo nlohmann/json downloaded from mirror 16 (Rackspace) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                                          echo Mirror 16 failed, trying mirror 17... >> logs/build.log
                                          curl -L -o json.zip https://mirror.netcologne.de/nlohmann/json/develop/json-develop.zip && echo nlohmann/json downloaded from mirror 17 (NetCologne) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                                            echo Mirror 17 failed, trying mirror 18... >> logs/build.log
                                            curl -L -o json.zip https://mirror.leaseweb.com/nlohmann/json/develop/json-develop.zip && echo nlohmann/json downloaded from mirror 18 (Leaseweb) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                                              echo Mirror 18 failed, trying mirror 19... >> logs/build.log
                                              curl -L -o json.zip https://mirror.nexcess.net/nlohmann/json/develop/json-develop.zip && echo nlohmann/json downloaded from mirror 19 (Nexcess) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                                                echo Mirror 19 failed, trying mirror 20... >> logs/build.log
                                                curl -L -o json.zip https://mirror.umd.edu/nlohmann/json/develop/json-develop.zip && echo nlohmann/json downloaded from mirror 20 (UMD) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                                                  echo Mirror 20 failed, trying mirror 21... >> logs/build.log
                                                  curl -L -o json.zip https://mirror.csclub.uwaterloo.ca/nlohmann/json/develop/json-develop.zip && echo nlohmann/json downloaded from mirror 21 (UWaterloo) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                                                    echo Mirror 21 failed, trying mirror 22... >> logs/build.log
                                                    curl -L -o json.zip https://mirror.ox.ac.uk/nlohmann/json/develop/json-develop.zip && echo nlohmann/json downloaded from mirror 22 (Oxford) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                                                      echo Mirror 22 failed, trying mirror 23... >> logs/build.log
                                                      curl -L -o json.zip https://mirror.yandex.ru/nlohmann/json/develop/json-develop.zip && echo nlohmann/json downloaded from mirror 23 (Yandex) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                                                        echo Mirror 23 failed, trying mirror 24... >> logs/build.log
                                                        curl -L -o json.zip https://mirror.1und1.de/nlohmann/json/develop/json-develop.zip && echo nlohmann/json downloaded from mirror 24 (1und1) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                                                          echo Mirror 24 failed, trying mirror 25... >> logs/build.log
                                                          curl -L -o json.zip https://mirror.easyname.at/nlohmann/json/develop/json-develop.zip && echo nlohmann/json downloaded from mirror 25 (Easyname) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                                                            echo Mirror 25 failed, trying mirror 26... >> logs/build.log
                                                            curl -L -o json.zip https://mirror.hetzner.de/nlohmann/json/develop/json-develop.zip && echo nlohmann/json downloaded from mirror 26 (Hetzner) >> logs/build.log && unzip -t json.zip >> logs/build.log 2>&1 && echo nlohmann/json archive validated >> logs/build.log || (
                                                              echo nlohmann/json download or validation failed from all sources >> logs/build.log
                                                              exit 1
                                                            )
                                                          )
                                                        )
                                                      )
                                                    )
                                                  )
                                                )
                                              )
                                            )
                                          )
                                        )
                                      )
                                    )
                                  )
                                )
                              )
                            )
                          )
                        )
                      )
                    )
                  )
                )
              )
            )
          )
        )
        unzip -o json.zip
        echo nlohmann/json unzipped >> logs/build.log
      shell: cmd
      if: steps.cache.outputs.cache-hit != 'true'

    - name: Build DLL
      run: |
        echo Building DLL... >> logs/build.log
        cl /D UNICODE /D _UNICODE /EHsc /Zi /Fe:RustAlkadCheat.dll /LD src/RustAlkadCheat2588.cpp /I imgui-master /I minhook-master/include /I zlib /I json-develop/single_include /link /LIBPATH:zlib zlib.lib user32.lib d3d11.lib dxgi.lib shell32.lib ws2_32.lib
        if %ERRORLEVEL% NEQ 0 (
          echo Build failed >> logs/build.log
          exit 1
        )
        echo Build successful >> logs/build.log
      shell: cmd

    - name: Upload logs
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: BuildLogs
        path: logs/build.log

    - name: Upload DLL
      uses: actions/upload-artifact@v4
      with:
        name: RustAlkadCheatDLL
        path: RustAlkadCheat.dll
